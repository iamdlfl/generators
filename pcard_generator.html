<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
	<title>PCard Generator</title>
</head>
<body>
	<main class="container">
		<!-- Navbar -->
		<nav class="navbar navbar-light bg-light m-2">
			<a href="honorarium_generator.html">
				<button id="showHonForm" class="btn btn-secondary">Honorarium Form</button> 
			</a>
			<a href="invoice_generator.html">
				<button id="showInvoiceForm" class="btn btn-secondary">Invoice Form</button>
			</a>
			<a href="pcard_generator.html">
				<button id="showPcardForm" class="btn btn-info">Pcard Form</button>
			</a>
		</nav>
		<!-- Form -->
		<form action="" id="pcardForm">
			<div class="form-group">
				<label for="pcardName">Name of PCard Holder</label>
				<input type="text" name="pcardName" id="pcardName" class="form-control" required>
			</div>
			<div class="form-group">
				<label for="pAmount">Charge Amount</label>
				<input type="number" step="0.01" name="pAmount" id="pAmount" class="form-control" required>
			</div>
			<div class="form-group">
				<label for="purpose">What was this purchase for?</label>
				<input type="text" name="purpose" id="purpose" class="form-control" required>
			</div>
			<div class="form-group">
				<label for="justification" class="">What is the justification for this expense? (Structure as normal)</label>
				<textarea cols="30" rows="10" name="justification" id="justification" class="form-control"></textarea>
			</div>
			<div class="form-group">
				<label for="sponsorCheck">Was this on the sponsor-approved budget?</label>
				<input type="checkbox" name="sponsorCheck" id="sponsorCheck" class="form-check">
			</div>
			<div class="form-group">
				<label for="chartfield">What is the chartfield for this expense?</label>
				<input type="text" name="chartfield" id="chartfield" class="form-control" required>
			</div>
			<div class="form-group">
				<label for="moduleCheck">Have you already entered the information on the PCard module?</label>
				<input type="checkbox" name="moduleCheck" id="moduleCheck" class="form-check">
			</div>
			<div id="moduleForm">
				<small class="mb-5">"I have already gone into the PCard module and uploaded a receipt of this charge, as well as filled in the distribution/chartfield. 
					Please leave the billing description as is. Many thanks."
				</small>
			</div>
			<div class="form-group" id="billingForm">
				<label for="billingDescription">What should the billing description be for this expense?</label>
				<input type="text" name="billingDescription" id="billingDescription" class="form-control">
			</div>
			<button class="btn btn-primary my-3">Submit</button>
		</form>
		<div id="results" class="mb-2">

		</div>
	</main>
	<script>
		// functions
		const uncheck = (targetDiv, ...targetEls) => {
			targetDiv.style['display'] = 'none';
			for (let el of targetEls) {
				el.value = '';
			}
		}


		// variable declarations
		let pcardForm = document.getElementById('pcardForm');
		let results = document.getElementById('results');
		let moduleForm = document.getElementById('moduleForm');
		let billingForm = document.getElementById('billingForm');

		let moduleCheck = document.getElementById('moduleCheck');
		let billingDescription = document.getElementById('billingDescription');

		moduleForm.style['display'] = 'none';

		// Event listeners to show and hide different forms/sections
		moduleCheck.addEventListener('click', () => {
			moduleCheck.checked ? 
			moduleForm.style['display'] = 'block':
			moduleForm.style['display'] = 'none';
		});
		moduleCheck.addEventListener('click', () => {
			moduleCheck.checked ? 
			uncheck(billingForm, billingDescription) :
			billingForm.style['display'] = 'block';
		});

		// Event listeners to return values from forms	
		pcardForm.addEventListener('submit', (e) => {
			e.preventDefault();

			// Variables to create text block
			let pcardName = document.getElementById('pcardName').value;
			let pAmount = parseFloat(document.getElementById('pAmount').value).toFixed(2);
			let purpose = document.getElementById('purpose').value;
			let justification = document.getElementById('justification').value;
			let sponsorApproved = document.getElementById('sponsorCheck').checked ? ' This expense is on the sponsor-approved budget. ' : '';
			let chartfield = document.getElementById('chartfield').value;
		

			let pcardRequestText = `Hello, I would like to request approval for the PCard charge of $${pAmount} on ${pcardName}'s PCard. ` +
			`This expense was for ${purpose}${purpose.slice(-1) === '.' ? '' : '.'} ` +
			`${justification} ` + 
			sponsorApproved + 
			`\n\nThe chartfield for this expense should be ${chartfield}. ` +
			// Ternary if module has been completed already
			`${moduleCheck.checked ? 
				"\n\n I have already gone into the PCard module and uploaded a receipt of this charge, as well as filled in the distribution/chartfield. " +
				"Please leave the billing description as is. Many thanks. " : 
				`\n\n Please find the receipt attached with this ticket. Please also leave "${billingDescription.value}" in the billing description.`
			}`

			results.innerText = pcardRequestText;

		});
		
	</script>
</body>
</html>